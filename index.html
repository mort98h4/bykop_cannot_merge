<!DOCTYPE html>
<html lang="da">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Splashsektion med infografik -->
    <section id="splash_index">
        <div class="splash_section_top">
            <div class="arrow_left"></div>
            <div class="splash_icon1">
                <img src="" alt="">
            </div>
            <div class="splash_icon2">
                <img src="" alt="">
            </div>
            <div class="splash_icon3">
                <img src="" alt="">
            </div>
            <div class="splash_icon4">
                <img src="" alt="">
            </div>
            <div class="character1"></div>
            <div class="character2"></div>
            <div class="character3"></div>
            <div class="skyline"></div>
            <div class="arrow_right"></div>
        </div>
        <div class="splash_index_bottom">
            <div class="round_bg"></div>
            <div class="splash_texts">

            </div>
        </div>
    </section>
    <main>
        <!-- Section med facts -->
        <section id="facts">
        </section>
        <!-- Section med kampagnevideoen -->
        <section id="about_index">
        </section>

        <!-- Templates -->
        <template id="splash_texts_template">
            <article class="splash_text">
                <h2></h2>
                <p></p>
                <h4 class="splash_button"></h4>
            </article>
        </template>
        <template id="facts_template">
            <article class="fact">
                <h3></h3>
                <p></p>
            </article>
        </template>
    </main>
    <script src="script.js"></script>
    <script>
        "use strict"

        // Variabler
        let theIcons;
        let iconFilter;
        let theFacts;
        let thePage;
        let theSkyline;

        // Venter på at DOM'en er indlæst
        document.addEventListener("DOMContentLoaded", start);

        // Henter ikoner og tilhørende tekst fra WP
        async function start() {
            console.log("start");
            let url = "http://mortengross.dk/kea/10_eksamen_2_sem/bykop/wordpress/wp-json/wp/v2/splash_icon";
            let jsonData = await fetch(url);
            theIcons = await jsonData.json();
            console.log(theIcons);

            // Ikonerne sættes ind i splashsektionen
            let icon1 = document.querySelector(".splash_icon1");
            let icon2 = document.querySelector(".splash_icon2");
            let icon3 = document.querySelector(".splash_icon3");
            let icon4 = document.querySelector(".splash_icon4");

            document.querySelector(".splash_icon1 img").src = theIcons[3].image.guid;
            document.querySelector(".splash_icon2 img").src = theIcons[2].image.guid;
            document.querySelector(".splash_icon3 img").src = theIcons[1].image.guid;
            document.querySelector(".splash_icon4 img").src = theIcons[0].image.guid;

            icon1.dataset.id = theIcons[3].id;
            icon2.dataset.id = theIcons[2].id;
            icon3.dataset.id = theIcons[1].id;
            icon4.dataset.id = theIcons[0].id;

            icon1.addEventListener("click", buttonClick);
            icon2.addEventListener("click", buttonClick);
            icon3.addEventListener("click", buttonClick);
            icon4.addEventListener("click", buttonClick);

            getTheSkyline();
            showTheSplashIcons(iconFilter = "101");
        }

        // Henter skyline grafikken fra WP
        async function getTheSkyline() {
            console.log("getTheSkyeline");
            let url = "http://mortengross.dk/kea/10_eksamen_2_sem/bykop/wordpress/wp-json/wp/v2/pages/121";
            let jsonData = await fetch(url);
            theSkyline = await jsonData.json();
            console.log(theSkyline);

            document.querySelector(".skyline").backgroundImage = `url(${theSkyline.splash_image.guid})`;

            getTheFacts();
        }

        function showTheSplashIcons() {
            console.log("showTheSplashIcons");
            let dest = document.querySelector(".splash_texts");
            let temp = document.querySelector("#splash_texts_template");

            dest.innerHTML = "";

            theIcons.forEach(icon => {
                if (iconFilter == icon.id) {
                    console.log(icon);
                    let clone = temp.cloneNode(true).content;

                    clone.querySelector("h2").textContent = icon.title.rendered;
                    clone.querySelector("p").innerHTML = icon.description;
                    clone.querySelector("h4").textContent = icon.button;

                    dest.appendChild(clone);
                }
            })
        }

        function buttonClick() {
            console.log("ID", this.dataset.id);
            iconFilter = this.dataset.id;
            showTheSplashIcons();
        }

        // Henter facts og tilhørende tekst fra WP
        async function getTheFacts() {
            console.log("getTheFacts");
            let url = "http://mortengross.dk/kea/10_eksamen_2_sem/bykop/wordpress/wp-json/wp/v2/frontpage_fact";
            let jsonData = await fetch(url);
            theFacts = await jsonData.json();
            console.log(theFacts);
            getThePage();
            showTheFacts();
        }

        // Henter forsiden fra WP
        async function getThePage() {
            console.log("getThePage");
            let url = "http://mortengross.dk/kea/10_eksamen_2_sem/bykop/wordpress/wp-json/wp/v2/pages/9";
            let jsonData = await fetch(url);
            thePage = await jsonData.json();
            console.log(thePage);

            document.querySelector("title").textContent = thePage.title.rendered + " | ByKop";
            document.querySelector(".splash_index_bottom").style.backgroundImage = `url(${thePage.splash_image.guid})`;
            document.querySelector("#about_index").innerHTML = thePage.content.rendered;
        }

        // Viser factsne i DOM'en
        function showTheFacts() {
            console.log("showTheFacts");

            let dest = document.querySelector("#facts");
            let temp = document.querySelector("#facts_template");

            // Tømmer dest for indhold
            dest.innerHTML = "";

            // Looper igennem de enkelte facts
            theFacts.forEach(fact => {
                // Definerer klonen
                let clone = temp.cloneNode(true).content;

                // Indholdet hentes fra WP og placeres i klonen
                clone.querySelector(".fact").style.backgroundImage = `url(${fact.image.guid})`;
                clone.querySelector("h3").textContent = fact.title.rendered;
                clone.querySelector("p").innerHTML = fact.description;

                // Sætter hver enkelt klon ind i DOM'en
                dest.appendChild(clone);
            })
        }
    </script>
</body></html>
